{
  "jobproc_jobcheck": [
    "select RQST.rqst_id,rqst_atype,rqst_aname,rqst_parms,",
    "RQST_D.d_scope, RQST_D.d_scope_id, RQST_D.d_ctgr, RQST_D.d_desc,",
    "rq_name,rq_message,",
    "email_txt_attrib, email_to, email_cc, email_bcc, email_attach,email_subject,email_text,email_html,email_d_id,RQST_EMAIL_D.D_FileName as email_d_filename,",
    "n_scope, n_scope_id, n_type, n_note,",
    "sms_txt_attrib,sms_to,sms_body",
    "from jsharmony.RQST",
    "left outer join jsharmony.RQST_D on RQST_D.rqst_id = RQST.rqst_id",
    "left outer join jsharmony.RQST_RQ on RQST_RQ.rqst_id = RQST.rqst_id",
    "left outer join jsharmony.RQST_EMAIL on RQST_EMAIL.rqst_id = RQST.rqst_id",
    "left outer join jsharmony.V_D_X RQST_EMAIL_D on RQST_EMAIL.email_d_id = RQST_EMAIL_D.d_id",
    "left outer join jsharmony.RQST_N on RQST_N.rqst_id = RQST.rqst_id",
    "left outer join jsharmony.RQST_SMS on RQST_SMS.rqst_id = RQST.rqst_id",
    "where rqst_rslt is null limit 1"
  ],
  "jobproc_saveD": [
    "with xrslt as (insert into D(d_scope,d_scope_id,c_id,D_STS,d_ctgr,d_desc,D_EXT,d_size,D_UU) values(@d_scope,@d_scope_id, ",
    "case @d_scope when 'C' then @d_scope_id else null end, ",
    "'A',@d_ctgr,@d_desc, '.pdf',@d_size, 'jobproc') returning d_id) select d_id from xrslt;"
  ],
  "jobproc_saveRQ": "with xrslt as (insert into jsharmony.RQ(rq_name,rq_message) values(@rq_name,'{}') returning rq_id) select rq_id from xrslt;",
  "jobproc_saverq_message": "update jsharmony.RQ set rq_message = @rq_message where rq_id=@rq_id;",
  "jobproc_saveN": "insert into jsharmony.N(n_scope,n_scope_id,n_sts,n_type,n_note) values(@n_scope,@n_scope_id,'A',@n_type,@n_note);",
  "jobproc_jobresult": "update jsharmony.RQST set rqst_rslt=@rqst_rslt,rqst_rslt_tstmp=public.myNOW(),rqst_snotes=@rqst_snotes where rqst_id=@rqst_id",
  "jobproc_add_BEGIN": "do $$declare rqst_id bigint; begin insert into jsharmony.RQST(rqst_source,rqst_atype,rqst_aname,rqst_parms) values (@rqst_source,@rqst_atype,@rqst_aname,@rqst_parms) returning jsharmony.RQST.rqst_id into rqst_id;",
  "jobproc_add_RQST_D": "insert into jsharmony.RQST_D(rqst_id,d_scope,d_scope_id,d_ctgr,d_desc) values (rqst_id,@d_scope,@d_scope_id,@d_ctgr,@d_desc);",
  "jobproc_add_RQST_RQ": "insert into jsharmony.RQST_RQ(rqst_id,rq_name,rq_message) values (rqst_id,@rq_name,@rq_message);",
  "jobproc_add_RQST_EMAIL": "insert into jsharmony.RQST_EMAIL(rqst_id,email_txt_attrib,email_to,email_cc,email_bcc,email_attach,email_subject,email_text,email_html,email_d_id) values (rqst_id,@email_txt_attrib,@email_to,@email_cc,@email_bcc,@email_attach,@email_subject,@email_text,@email_html,@email_d_id);",
  "jobproc_add_RQST_SMS": "insert into jsharmony.RQST_SMS(rqst_id,sms_txt_attrib,sms_to,sms_body) values (rqst_id,@sms_txt_attrib,@sms_to,@sms_body);",
  "jobproc_add_RQST_N": "insert into jsharmony.RQST_N(rqst_id,n_scope,n_scope_id,n_type,n_note) values (rqst_id,@n_scope,@n_scope_id,@n_type,@n_note);",
  "jobproc_add_END": " end$$;",
  "jobproc_queueresult": "update jsharmony.RQ set rq_rslt=@rq_rslt,rq_rslt_tstmp=public.myNOW(),rq_snotes=@rq_snotes where rq_id=@rq_id",
  "jobproc_queuecheck": "select rq_id, rq_name, rq_message from jsharmony.RQ where rq_name=@rq_name and rq_rslt is null order by rq_id limit 1",
  "jobproc_queuesubscribers": [
    "WITH CTE AS (SELECT rq_id, rq_name, rq_message,ROW_NUMBER() OVER (PARTITION BY rq_name ORDER BY rq_id) as RN FROM jsharmony.RQ where rq_rslt is null)",
    "select rq_id, rq_name, rq_message",
    "from CTE",
    "where RN=1",
    "order by rq_id"
  ],
  "jobproc_queuepop": "select rq_id from jsharmony.RQ where rq_id=@rq_id and rq_name=@rq_name and rq_rslt is null"
}
